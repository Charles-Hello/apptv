尝试连接到WebSocket服务器: wss://47.106.254.103:5003
manager.js:108  WebSocket connection to 'wss://47.106.254.103:5003/socket.io/?EIO=4&transport=websocket' failed: 
value @ websocket.js:44
value @ transport.js:45
value @ socket.js:164
a @ socket.js:105
value @ manager.js:108
s @ manager.js:39
Pt @ index.js:29
initWebSocket @ player?url=https%3A%2F%2Fvodcnd02.wyfkg.cn%2F20250125%2FXfS3nxgj%2Findex.m3u8&title=%E5%91%A8%E5%A4%84%E9%99%A4%E4%B8%89%E5%AE%B3&index=0&source=%E8%B1%86%E7%93%A3%E8%B5%84%E6%BA%90&source_code=dbzy:386
pushCurrentUrl @ player?url=https%3A%2F%2Fvodcnd02.wyfkg.cn%2F20250125%2FXfS3nxgj%2Findex.m3u8&title=%E5%91%A8%E5%A4%84%E9%99%A4%E4%B8%89%E5%AE%B3&index=0&source=%E8%B1%86%E7%93%A3%E8%B5%84%E6%BA%90&source_code=dbzy:463
player?url=https%3A%2F%2Fvodcnd02.wyfkg.cn%2F20250125%2FXfS3nxgj%2Findex.m3u8&title=%E5%91%A8%E5%A4%84%E9%99%A4%E4%B8%89%E5%AE%B3&index=0&source=%E8%B1%86%E7%93%A3%E8%B5%84%E6%BA%90&source_code=dbzy:402  WebSocket连接错误: i: websocket error
    at i.value (https://cdn.socket.io/4.6.0/socket.io.min.js:6:8279)
    at ws.onerror (https://cdn.socket.io/4.6.0/socket.io.min.js:6:16204)
(匿名) @ player?url=https%3A%2F%2Fvodcnd02.wyfkg.cn%2F20250125%2FXfS3nxgj%2Findex.m3u8&title=%E5%91%A8%E5%A4%84%E9%99%A4%E4%B8%89%E5%AE%B3&index=0&source=%E8%B1%86%E7%93%A3%E8%B5%84%E6%BA%90&source_code=dbzy:402
L.emit @ index.mjs:136
value @ socket.js:415
L.emit @ index.mjs:136
(匿名) @ manager.js:122
L.emit @ index.mjs:136
value @ socket.js:524
L.emit @ index.mjs:136
value @ transport.js:37
ws.onerror @ websocket.js:70
player?url=https%3A%2F%2Fvodcnd02.wyfkg.cn%2F20250125%2FXfS3nxgj%2Findex.m3u8&title=%E5%91%A8%E5%A4%84%E9%99%A4%E4%B8%89%E5%AE%B3&index=0&source=%E8%B1%86%E7%93%A3%E8%B5%84%E6%BA%90&source_code=dbzy:407 WebSocket连接失败，尝试使用HTTPS连接
manager.js:108  WebSocket connection to 'wss://47.106.254.103:5003/socket.io/?EIO=4&transport=websocket' failed: 
value @ websocket.js:44
value @ transport.js:45
value @ socket.js:164
a @ socket.js:105
value @ manager.js:108
(匿名) @ manager.js:331
player?url=https%3A%2F%2Fvodcnd02.wyfkg.cn%2F20250125%2FXfS3nxgj%2Findex.m3u8&title=%E5%91%A8%E5%A4%84%E9%99%A4%E4%B8%89%E5%AE%B3&index=0&source=%E8%B1%86%E7%93%A3%E8%B5%84%E6%BA%90&source_code=dbzy:402  WebSocket连接错误: i: websocket error
    at i.value (https://cdn.socket.io/4.6.0/socket.io.min.js:6:8279)
    at ws.onerror (https://cdn.socket.io/4.6.0/socket.io.min.js:6:16204)
(匿名) @ player?url=https%3A%2F%2Fvodcnd02.wyfkg.cn%2F20250125%2FXfS3nxgj%2Findex.m3u8&title=%E5%91%A8%E5%A4%84%E9%99%A4%E4%B8%89%E5%AE%B3&index=0&source=%E8%B1%86%E7%93%A3%E8%B5%84%E6%BA%90&source_code=dbzy:402
L.emit @ index.mjs:136
value @ socket.js:415
L.emit @ index.mjs:136
(匿名) @ manager.js:122
L.emit @ index.mjs:136
value @ socket.js:524
L.emit @ index.mjs:136
value @ transport.js:37
ws.onerror @ websocket.js:70
player?url=https%3A%2F%2Fvodcnd02.wyfkg.cn%2F20250125%2FXfS3nxgj%2Findex.m3u8&title=%E5%91%A8%E5%A4%84%E9%99%A4%E4%B8%89%E5%AE%B3&index=0&source=%E8%B1%86%E7%93%A3%E8%B5%84%E6%BA%90&source_code=dbzy:407 WebSocket连接失败，尝试使用HTTPS连接
manager.js:108  WebSocket connection to 'wss://47.106.254.103:5003/socket.io/?EIO=4&transport=websocket' failed: 
value @ websocket.js:44
value @ transport.js:45
value @ socket.js:164
a @ socket.js:105
value @ manager.js:108
s @ manager.js:39
Pt @ index.js:29
tryAlternativeConnection @ player?url=https%3A%2F%2Fvodcnd02.wyfkg.cn%2F20250125%2FXfS3nxgj%2Findex.m3u8&title=%E5%91%A8%E5%A4%84%E9%99%A4%E4%B8%89%E5%AE%B3&index=0&source=%E8%B1%86%E7%93%A3%E8%B5%84%E6%BA%90&source_code=dbzy:438
(匿名) @ player?url=https%3A%2F%2Fvodcnd02.wyfkg.cn%2F20250125%2FXfS3nxgj%2Findex.m3u8&title=%E5%91%A8%E5%A4%84%E9%99%A4%E4%B8%89%E5%AE%B3&index=0&source=%E8%B1%86%E7%93%A3%E8%B5%84%E6%BA%90&source_code=dbzy:408
L.emit @ index.mjs:136
value @ socket.js:415
L.emit @ index.mjs:136
(匿名) @ manager.js:122
L.emit @ index.mjs:136
value @ socket.js:524
L.emit @ index.mjs:136
value @ transport.js:37
ws.onerror @ websocket.js:70
player?url=https%3A%2F%2Fvodcnd02.wyfkg.cn%2F20250125%2FXfS3nxgj%2Findex.m3u8&title=%E5%91%A8%E5%A4%84%E9%99%A4%E4%B8%89%E5%AE%B3&index=0&source=%E8%B1%86%E7%93%A3%E8%B5%84%E6%BA%90&source_code=dbzy:451  替代连接方式也失败: i: websocket error
    at i.value (https://cdn.socket.io/4.6.0/socket.io.min.js:6:8279)
    at ws.onerror (https://cdn.socket.io/4.6.0/socket.io.min.js:6:16204)


const WEBSOCKET_SERVER_URL = "https://47.106.254.103:5003";
    let socket = null;

    // 检测当前页面协议并选择适当的WebSocket协议
    function getAppropriateWebSocketUrl() {
      // 获取服务器基本地址（不带协议）
      const serverBase = WEBSOCKET_SERVER_URL.replace(/^https?:\/\//, '');

      // 检测当前页面是否使用HTTPS
      const isSecure = window.location.protocol === 'https:';

      // 根据页面协议选择WebSocket协议
      if (isSecure) {
        // 如果页面是HTTPS，尝试WSS
        return `wss://${serverBase}`;
      } else {
        // 如果页面是HTTP，可以使用WS
        return `ws://${serverBase}`;
      }
    }

    // 初始化WebSocket连接
    function initWebSocket() {
      try {
        // 使用适当的WebSocket URL
        const wsUrl = getAppropriateWebSocketUrl();
        console.log(`尝试连接到WebSocket服务器: ${wsUrl}`);

        // 尝试连接
        socket = io(wsUrl, {
          transports: ['websocket'],   // 优先使用WebSocket
          secure: window.location.protocol === 'https:',  // 根据页面协议决定是否使用安全连接
          rejectUnauthorized: false    // 允许自签名证书（仅用于测试）
        });

        socket.on('connect', () => {
          console.log('已连接到WebSocket服务器');
          showToast('已连接到推送服务器', 'success');
        });

        socket.on('disconnect', () => {
          console.log('已断开WebSocket连接');
        });

        socket.on('connect_error', (error) => {
          console.error('WebSocket连接错误:', error);
          showToast('推送服务器连接失败', 'error');

          // 如果WebSocket连接失败，尝试使用原始HTTP/HTTPS连接
          if (wsUrl.startsWith('wss://')) {
            console.log('WebSocket连接失败，尝试使用HTTPS连接');
            tryAlternativeConnection(WEBSOCKET_SERVER_URL);
          }
        });

        socket.on('open_url_response', (data) => {
          console.log('收到URL发送响应:', data);
          showToast('URL推送成功', 'success');
        });

        socket.on('status_update', (data) => {
          console.log('收到状态更新:', data);
        });
      } catch (e) {
        console.error('初始化WebSocket失败:', e);
        showToast('初始化推送服务失败', 'error');

        // 出错时尝试使用原始URL
        tryAlternativeConnection(WEBSOCKET_SERVER_URL);
      }
    }

    // 尝试使用替代连接方式
    function tryAlternativeConnection(url) {
      try {
        // 断开现有连接
        if (socket && socket.connected) {
          socket.disconnect();
        }

        // 尝试新的连接
        socket = io(url, {
          transports: ['websocket'],  // 强制使用WebSocket，不使用polling
          secure: true,               // 强制使用安全连接
          rejectUnauthorized: false   // 允许自签名证书（仅用于测试）
        });

        // 设置新连接的事件处理
        socket.on('connect', () => {
          console.log('已使用替代方式连接到WebSocket服务器');
          showToast('已连接到推送服务器', 'success');
        });

        socket.on('connect_error', (error) => {
          console.error('替代连接方式也失败:', error);
          showToast('无法连接到推送服务器，请确认服务器支持HTTPS/WSS', 'error');
        });
      } catch (e) {
        console.error('尝试替代连接方式失败:', e);
      }
    }

    // 发送当前URL到WebSocket服务器
    function pushCurrentUrl() {
      if (!socket || !socket.connected) {
        // 如果未连接，尝试重新连接
        initWebSocket();
        showToast('正在连接推送服务器...', 'info');

        // // 等待连接建立后再发送
        setTimeout(() => {
          if (socket && socket.connected) {
            sendUrl();
          } else {
            showToast('推送服务器连接失败', 'error');
          }
        }, 1000);
      } else {
        // 已连接，直接发送
        sendUrl();
      }
    }

    // 发送URL
    function sendUrl() {
      const currentUrl = window.location.href;
      console.log('推送URL:', currentUrl);

      socket.emit('open_url', { url: currentUrl });
      showToast('URL已推送', 'info');
    }

是这样发送过去的

我把服务部署在cloudflare的page中去发送，都不行。本地去发送的话可以，就是cloudflare不行。你看看我的main.py接收websocket。